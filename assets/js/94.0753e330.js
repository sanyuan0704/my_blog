(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{174:function(t,e,s){"use strict";s.r(e);var a=s(0),n=Object(a.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),s("p",[t._v("接着进入相同的域名时就能拿到相应的值:")]),t._v(" "),t._m(17),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._v(" "),t._m(24),t._v(" "),t._m(25),t._v(" "),t._m(26),t._v(" "),t._m(27),t._v(" "),t._m(28),t._v(" "),t._m(29),t._v(" "),s("p",[t._v("关于它的使用，本文侧重原理，而且 MDN 上的教程文档已经非常详尽，这里就不做赘述了，感兴趣可以看一下"),s("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API/Using_IndexedDB",target:"_blank",rel:"noopener noreferrer"}},[t._v("使用文档"),s("OutboundLink")],1),t._v("。")]),t._v(" "),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),t._v(" "),s("p",[t._v("浏览器中各种本地存储和缓存技术的发展，给前端应用带来了大量的机会，PWA 也正是依托了这些优秀的存储方案才得以发展起来。重新梳理一下这些本地存储方案:")]),t._v(" "),t._m(33)])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"_002-能不能说一说浏览器的本地存储？各自优劣如何？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_002-能不能说一说浏览器的本地存储？各自优劣如何？","aria-hidden":"true"}},[this._v("#")]),this._v(" 002: 能不能说一说浏览器的本地存储？各自优劣如何？")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("浏览器的本地存储主要分为"),s("code",[t._v("Cookie")]),t._v("、"),s("code",[t._v("WebStorage")]),t._v("和"),s("code",[t._v("IndexDB")]),t._v(", 其中"),s("code",[t._v("WebStorage")]),t._v("又可以分为"),s("code",[t._v("localStorage")]),t._v("和"),s("code",[t._v("sessionStorage")]),t._v("。接下来我们就来一一分析这些本地存储方案。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"cookie"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cookie","aria-hidden":"true"}},[this._v("#")]),this._v(" Cookie")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("Cookie")]),this._v(" 最开始被设计出来其实并不是来做本地存储的，而是为了弥补"),e("code",[this._v("HTTP")]),this._v("在"),e("strong",[this._v("状态管理上的不足")]),this._v("。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("HTTP")]),this._v(" 协议是一个无状态协议，客户端向服务器发请求，服务器返回响应，故事就这样结束了，但是下次发请求如何让服务端知道客户端是谁呢？")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("这种背景下，就产生了 "),e("code",[this._v("Cookie")]),this._v(".")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Cookie 本质上就是浏览器里面存储的一个很小的文本文件，内部以键值对的方式来存储(在chrome开发者面板的"),e("code",[this._v("Application")]),this._v("这一栏可以看到)。向同一个域名下发送请求，都会携带相同的 Cookie，服务器拿到 Cookie 进行解析，便能拿到客户端的状态。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Cookie 的作用很好理解，就是用来做"),e("strong",[this._v("状态存储")]),this._v("的，但它也是有诸多致命的缺陷的：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ol",[s("li",[s("p",[t._v("容量缺陷。Cookie 的体积上限只有"),s("code",[t._v("4KB")]),t._v("，只能用来存储少量的信息。")])]),t._v(" "),s("li",[s("p",[t._v("性能缺陷。Cookie 紧跟域名，不管域名下面的某一个地址需不需要这个 Cookie ，请求都会携带上完整的 Cookie，这样随着请求数的增多，其实会造成巨大的性能浪费的，因为请求携带了很多不必要的内容。")])]),t._v(" "),s("li",[s("p",[t._v("安全缺陷。由于 Cookie 以纯文本的形式在浏览器和服务器中传递，很容易被非法用户截获，然后进行一系列的篡改，在 Cookie 的有效期内重新发送给服务器，这是相当危险的。另外，在"),s("code",[t._v("HttpOnly")]),t._v("为 false 的情况下，Cookie 信息能直接通过 JS 脚本来读取。")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"localstorage"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#localstorage","aria-hidden":"true"}},[this._v("#")]),this._v(" localStorage")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"和cookie异同"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#和cookie异同","aria-hidden":"true"}},[this._v("#")]),this._v(" 和Cookie异同")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("localStorage")]),this._v("有一点跟"),e("code",[this._v("Cookie")]),this._v("一样，就是针对一个域名，即在同一个域名下，会存储相同的一段"),e("strong",[this._v("localStorage")]),this._v("。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("不过它相对"),e("code",[this._v("Cookie")]),this._v("还是有相当多的区别的:")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ol",[s("li",[s("p",[t._v("容量。localStorage 的容量上限为"),s("strong",[t._v("5M")]),t._v("，相比于"),s("code",[t._v("Cookie")]),t._v("的 4K 大大增加。当然这个 5M 是针对一个域名的，因此对于一个域名是持久存储的。")])]),t._v(" "),s("li",[s("p",[t._v("只存在客户端，默认不参与与服务端的通信。这样就很好地避免了 Cookie 带来的"),s("strong",[t._v("性能问题")]),t._v("和"),s("strong",[t._v("安全问题")]),t._v("。")])]),t._v(" "),s("li",[s("p",[t._v("接口封装。通过"),s("code",[t._v("localStorage")]),t._v("暴露在全局，并通过它的 "),s("code",[t._v("setItem")]),t._v(" 和 "),s("code",[t._v("getItem")]),t._v("等方法进行操作，非常方便。")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"操作方式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#操作方式","aria-hidden":"true"}},[this._v("#")]),this._v(" 操作方式")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("接下来我们来具体看看如何来操作"),e("code",[this._v("localStorage")]),this._v("。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" obj "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sanyuan"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" age"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nlocalStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sanyuan"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \nlocalStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"info"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("obj"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" localStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" info "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("localStorage"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getItem")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"info"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("从这里可以看出，"),s("code",[t._v("localStorage")]),t._v("其实存储的都是字符串，如果是存储对象需要调用"),s("code",[t._v("JSON")]),t._v("的"),s("code",[t._v("stringify")]),t._v("方法，并且用"),s("code",[t._v("JSON.parse")]),t._v("来解析成对象。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"应用场景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#应用场景","aria-hidden":"true"}},[this._v("#")]),this._v(" 应用场景")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("利用"),s("code",[t._v("localStorage")]),t._v("的较大容量和持久特性，可以利用"),s("code",[t._v("localStorage")]),t._v("存储一些内容稳定的资源，比如官网的"),s("code",[t._v("logo")]),t._v("，存储"),s("code",[t._v("Base64")]),t._v("格式的图片资源，因此利用"),s("code",[t._v("localStorage")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"sessionstorage"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sessionstorage","aria-hidden":"true"}},[this._v("#")]),this._v(" sessionStorage")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"特点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#特点","aria-hidden":"true"}},[this._v("#")]),this._v(" 特点")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("sessionStorage")]),this._v("以下方面和"),e("code",[this._v("localStorage")]),this._v("一致:")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[t._v("容量。容量上限也为 5M。")]),t._v(" "),s("li",[t._v("只存在客户端，默认不参与与服务端的通信。")]),t._v(" "),s("li",[t._v("接口封装。除了"),s("code",[t._v("sessionStorage")]),t._v("名字有所变化，存储方式、操作方式均和"),s("code",[t._v("localStorage")]),t._v("一样。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("但"),e("code",[this._v("sessionStorage")]),this._v("和"),e("code",[this._v("localStorage")]),this._v("有一个本质的区别，那就是前者只是会话级别的存储，并不是持久化存储。会话结束，也就是页面关闭，这部分"),e("code",[this._v("sessionStorage")]),this._v("就不复存在了。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"应用场景-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#应用场景-2","aria-hidden":"true"}},[this._v("#")]),this._v(" 应用场景")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("可以用它对表单信息进行维护，将表单信息存储在里面，可以保证页面即使刷新也不会让之前的表单信息丢失。")]),this._v(" "),e("li",[this._v("可以用它存储本次浏览记录。如果关闭页面后不需要这些记录，用"),e("code",[this._v("sessionStorage")]),this._v("就再合适不过了。事实上微博就采取了这样的存储方式。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"indexdb"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#indexdb","aria-hidden":"true"}},[this._v("#")]),this._v(" IndexDB")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("IndexDB")]),this._v("是运行在浏览器中的"),e("code",[this._v("非关系型数据库")]),this._v(", 本质上是数据库，绝不是和刚才WebStorage的 5M 一个量级，理论上这个容量是没有上限的。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("接着我们来分析一下"),e("code",[this._v("IndexDB")]),this._v("的一些重要特性，除了拥有数据库本身的特性，比如"),e("code",[this._v("支持事务")]),this._v("，"),e("code",[this._v("存储二进制数据")]),this._v("，还有这样一些特性需要格外注意：")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ol",[s("li",[t._v("键值对存储。内部采用"),s("code",[t._v("对象仓库")]),t._v("存放数据，在这个对象仓库中数据采用"),s("strong",[t._v("键值对")]),t._v("的方式来存储。")]),t._v(" "),s("li",[t._v("异步操作。数据库的读写属于 I/O 操作, 浏览器中对异步 I/O 提供了支持。")]),t._v(" "),s("li",[t._v("受同源策略限制，即无法访问跨域的数据库。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[this._v("#")]),this._v(" 总结")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ol",[s("li",[s("code",[t._v("cookie")]),t._v("并不适合存储，而且存在非常多的缺陷。")]),t._v(" "),s("li",[s("code",[t._v("Web Storage")]),t._v("包括"),s("code",[t._v("localStorage")]),t._v("和"),s("code",[t._v("sessionStorage")]),t._v(", 默认不会参与和服务器的通信。")]),t._v(" "),s("li",[s("code",[t._v("IndexDB")]),t._v("为运行在浏览器上的非关系型数据库，为大型数据的存储提供了接口。")])])}],!1,null,null,null);e.default=n.exports}}]);