(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{558:function(s,n,a){"use strict";a.r(n);var e=a(4),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("对于几百 M 甚至上 G 的大文件来说，如果要一口气全部传输过来显然是不现实的，会有大量的等待时间，严重影响用户体验。因此，HTTP 针对这一场景，采取了"),a("code",[s._v("范围请求")]),s._v("的解决方案，允许客户端仅仅请求一个资源的一部分。")]),s._v(" "),a("h2",{attrs:{id:"如何支持"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何支持"}},[s._v("#")]),s._v(" 如何支持")]),s._v(" "),a("p",[s._v("当然，前提是服务器要支持"),a("strong",[s._v("范围请求")]),s._v("，要支持这个功能，就必须加上这样一个响应头:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Accept-Ranges: none\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("用来告知客户端这边是支持范围请求的。")]),s._v(" "),a("h2",{attrs:{id:"range-字段拆解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#range-字段拆解"}},[s._v("#")]),s._v(" Range 字段拆解")]),s._v(" "),a("p",[s._v("而对于客户端而言，它需要指定请求哪一部分，通过"),a("code",[s._v("Range")]),s._v("这个请求头字段确定，格式为"),a("code",[s._v("bytes=x-y")]),s._v("。接下来就来讨论一下这个 Range 的书写格式:")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("0-499")]),s._v("表示从开始到第 499 个字节。")]),s._v(" "),a("li",[a("strong",[s._v("500")]),s._v("- 表示从第 500 字节到文件终点。")]),s._v(" "),a("li",[a("strong",[s._v("-100")]),s._v("表示文件的最后100个字节。")])]),s._v(" "),a("p",[s._v("服务器收到请求之后，首先验证范围"),a("strong",[s._v("是否合法")]),s._v("，如果越界了那么返回"),a("code",[s._v("416")]),s._v("错误码，否则读取相应片段，返回"),a("code",[s._v("206")]),s._v("状态码。")]),s._v(" "),a("p",[s._v("同时，服务器需要添加"),a("code",[s._v("Content-Range")]),s._v("字段，这个字段的格式根据请求头中"),a("code",[s._v("Range")]),s._v("字段的不同而有所差异。")]),s._v(" "),a("p",[s._v("具体来说，请求"),a("code",[s._v("单段数据")]),s._v("和请求"),a("code",[s._v("多段数据")]),s._v("，响应头是不一样的。")]),s._v(" "),a("p",[s._v("举个例子:")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 单段数据")]),s._v("\nRange"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" bytes"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 多段数据")]),s._v("\nRange"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" bytes"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("39")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("接下来我们就分别来讨论着两种情况。")]),s._v(" "),a("h2",{attrs:{id:"单段数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单段数据"}},[s._v("#")]),s._v(" 单段数据")]),s._v(" "),a("p",[s._v("对于"),a("code",[s._v("单段数据")]),s._v("的请求，返回的响应如下:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("HTTP/1.1 206 Partial Content\nContent-Length: 10\nAccept-Ranges: bytes\nContent-Range: bytes 0-9/100\n\ni am xxxxx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("值得注意的是"),a("code",[s._v("Content-Range")]),s._v("字段，"),a("code",[s._v("0-9")]),s._v("表示请求的返回，"),a("code",[s._v("100")]),s._v("表示资源的总大小，很好理解。")]),s._v(" "),a("h2",{attrs:{id:"多段数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多段数据"}},[s._v("#")]),s._v(" 多段数据")]),s._v(" "),a("p",[s._v("接下来我们看看多段请求的情况。得到的响应会是下面这个形式:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("HTTP/1.1 206 Partial Content\nContent-Type: multipart/byteranges; boundary=00000010101\nContent-Length: 189\nConnection: keep-alive\nAccept-Ranges: bytes\n\n\n--00000010101\nContent-Type: text/plain\nContent-Range: bytes 0-9/96\n\ni am xxxxx\n--00000010101\nContent-Type: text/plain\nContent-Range: bytes 20-29/96\n\neex jspy e\n--00000010101--\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("这个时候出现了一个非常关键的字段"),a("code",[s._v("Content-Type: multipart/byteranges;boundary=00000010101")]),s._v("，它代表了信息量是这样的:")]),s._v(" "),a("ul",[a("li",[s._v("请求一定是多段数据请求")]),s._v(" "),a("li",[s._v("响应体中的分隔符是 00000010101")])]),s._v(" "),a("p",[s._v("因此，在响应体中各段数据之间会由这里指定的分隔符分开，而且在最后的分隔末尾添上"),a("code",[s._v("--")]),s._v("表示结束。")]),s._v(" "),a("p",[s._v("以上就是 http 针对大文件传输所采用的手段。")])])}),[],!1,null,null,null);n.default=t.exports}}]);